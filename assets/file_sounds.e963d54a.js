var ie=Object.defineProperty,re=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var K=(e,t,l)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,_=(e,t)=>{for(var l in t||(t={}))se.call(t,l)&&K(e,l,t[l]);if(W)for(var l of W(t))ce.call(t,l)&&K(e,l,t[l]);return e},A=(e,t)=>re(e,oe(t));import{u as Z,a as ee,Q as E,R as de,b as ve,c as fe,d as me,e as ge,f as be,g as he,h as ye,i as _e,j as Ce,k as xe,l as X,m as ke,n as G,o as R,p as H,q as qe,r as we}from"./QCard.89a68308.js";import{u as te,a as le,Q as Fe}from"./QPage.ddd0f60f.js";import{c as L,a as c,h as Se,b as m,d as Ve,g as O,s as Be,r as x,p as Ae,e as je,f as $e,w as De,i as Ue,j as p,o as Ie,k as C,l as z,t as Re}from"./index.2aca836f.js";const pe={xs:8,sm:10,md:14,lg:20,xl:24};var ze=L({name:"QChip",props:A(_(_({},te),Z),{dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}}),emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:l}){const{proxy:{$q:a}}=O(),u=le(e,a),i=ee(e,pe),d=c(()=>e.selected===!0||e.icon!==void 0),b=c(()=>e.selected===!0?e.iconSelected||a.iconSet.chip.selected:e.icon),r=c(()=>e.iconRemove||a.iconSet.chip.remove),w=c(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),k=c(()=>{const o=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(o?` text-${o} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(w.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(u.value===!0?" q-chip--dark q-dark":"")}),h=c(()=>e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0});function S(o){o.keyCode===13&&V(o)}function V(o){e.disable||(l("update:selected",!e.selected),l("click",o))}function B(o){(o.keyCode===void 0||o.keyCode===13)&&(Be(o),e.disable===!1&&(l("update:modelValue",!1),l("remove")))}function s(){const o=[];w.value===!0&&o.push(m("div",{class:"q-focus-helper"})),d.value===!0&&o.push(m(E,{class:"q-chip__icon q-chip__icon--left",name:b.value}));const j=e.label!==void 0?[m("div",{class:"ellipsis"},[e.label])]:void 0;return o.push(m("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Ve(t.default,j))),e.iconRight&&o.push(m(E,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&o.push(m(E,A(_({class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:r.value},h.value),{onClick:B,onKeyup:B}))),o}return()=>{if(e.modelValue===!1)return;const o={class:k.value,style:i.value};return w.value===!0&&Object.assign(o,h.value,{onClick:V,onKeyup:S}),Se("div",o,s(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[de,e.ripple]])}}}),Pe=L({name:"QFile",inheritAttrs:!1,props:A(_(_(_({},ve),fe),me),{modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]}),emits:[...ge,...be],setup(e,{slots:t,emit:l,attrs:a}){const{proxy:u}=O(),i=he(),d=x(null),b=x(!1),r=ye(e),{pickFiles:w,onDragover:k,onDragleave:h,processFiles:S,getDndNode:V}=_e({editable:i.editable,dnd:b,getFileInput:M,addFilesToQueue:T}),B=Ce(e),s=c(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),o=c(()=>X(s.value)),j=c(()=>s.value.map(n=>n.name).join(", ")),D=c(()=>ke(s.value.reduce((n,y)=>n+y.size,0))),Q=c(()=>({totalSize:D.value,filesNumber:s.value.length,maxFiles:e.maxFiles})),N=c(()=>A(_({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:r.value},a),{id:i.targetUid.value,disabled:i.editable.value!==!0})),f=c(()=>e.multiple===!0&&e.append===!0);function v(n){const y=s.value.slice();y.splice(n,1),q(y)}function g(n){const y=s.value.findIndex(n);y>-1&&v(y)}function q(n){l("update:modelValue",e.multiple===!0?n:n[0])}function U(n){n.keyCode===13&&Ae(n)}function $(n){(n.keyCode===13||n.keyCode===32)&&w(n)}function M(){return d.value}function T(n,y){const F=S(n,y,s.value,f.value);F!==void 0&&((e.multiple===!0?e.modelValue&&F.every(ue=>s.value.includes(ue)):e.modelValue===F[0])||q(f.value===!0?s.value.concat(F):F))}function I(){return[m("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ae(){if(t.file!==void 0)return s.value.length===0?I():s.value.map((y,F)=>t.file({index:F,file:y,ref:this}));if(t.selected!==void 0)return s.value.length===0?I():t.selected({files:s.value,ref:this});if(e.useChips===!0)return s.value.length===0?I():s.value.map((y,F)=>m(ze,{key:"file-"+F,removable:i.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(F)}},()=>m("span",{class:"ellipsis",textContent:y.name})));const n=e.displayValue!==void 0?e.displayValue:j.value;return n.length>0?[m("div",{class:e.inputClass,style:e.inputStyle,textContent:n})]:I()}function ne(){const n=A(_(_({ref:d},N.value),B.value),{class:"q-field__input fit absolute-full cursor-pointer",onChange:T});return e.multiple===!0&&(n.multiple=!0),m("input",n)}return Object.assign(i,{fieldClass:{value:"q-file q-field--auto-height"},emitValue:q,hasValue:o,inputRef:d,innerValue:s,floatingLabel:c(()=>o.value===!0||X(e.displayValue)),computedCounter:c(()=>{if(e.counterLabel!==void 0)return e.counterLabel(Q.value);const n=e.maxFiles;return`${s.value.length}${n!==void 0?" / "+n:""} (${D.value})`}),getControlChild:()=>V("file"),getControl:()=>{const n={ref:i.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return i.editable.value===!0&&Object.assign(n,{onDragover:k,onDragleave:h,onKeydown:U,onKeyup:$}),m("div",n,[ne()].concat(ae()))}}),Object.assign(u,{removeAtIndex:v,removeFile:g,getNativeElement:()=>d.value}),xe(i)}});const Qe={xs:2,sm:4,md:6,lg:10,xl:14};function J(e,t,l){return{transform:t===!0?`translateX(${l.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var Y=L({name:"QLinearProgress",props:A(_(_({},te),Z),{value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean}),setup(e,{slots:t}){const{proxy:l}=O(),a=le(e,l.$q),u=ee(e,Qe),i=c(()=>e.indeterminate===!0||e.query===!0),d=c(()=>e.reverse!==e.query),b=c(()=>A(_({},u.value!==null?u.value:{}),{"--q-linear-progress-speed":`${e.animationSpeed}ms`})),r=c(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),w=c(()=>J(e.buffer!==void 0?e.buffer:1,d.value,l.$q)),k=c(()=>`q-linear-progress__track absolute-full q-linear-progress__track--with${e.instantFeedback===!0?"out":""}-transition q-linear-progress__track--${a.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),h=c(()=>J(i.value===!0?1:e.value,d.value,l.$q)),S=c(()=>`q-linear-progress__model absolute-full q-linear-progress__model--with${e.instantFeedback===!0?"out":""}-transition q-linear-progress__model--${i.value===!0?"in":""}determinate`),V=c(()=>({width:`${e.value*100}%`})),B=c(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"}`);return()=>{const s=[m("div",{class:k.value,style:w.value}),m("div",{class:S.value,style:h.value})];return e.stripe===!0&&i.value===!1&&s.push(m("div",{class:B.value,style:V.value})),m("div",{class:r.value,style:b.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},je(t.default,s))}}}),Ne=Ee;function Ee(e,t){t=t||{};var l=e.numberOfChannels,a=e.sampleRate,u=t.float32?3:1,i=u===3?32:16,d;return l===2?d=Oe(e.getChannelData(0),e.getChannelData(1)):d=e.getChannelData(0),Le(d,u,a,l,i)}function Le(e,t,l,a,u){var i=u/8,d=a*i,b=new ArrayBuffer(44+e.length*i),r=new DataView(b);return P(r,0,"RIFF"),r.setUint32(4,36+e.length*i,!0),P(r,8,"WAVE"),P(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,t,!0),r.setUint16(22,a,!0),r.setUint32(24,l,!0),r.setUint32(28,l*d,!0),r.setUint16(32,d,!0),r.setUint16(34,u,!0),P(r,36,"data"),r.setUint32(40,e.length*i,!0),t===1?Te(r,44,e):Me(r,44,e),b}function Oe(e,t){for(var l=e.length+t.length,a=new Float32Array(l),u=0,i=0;u<l;)a[u++]=e[i],a[u++]=t[i],i++;return a}function Me(e,t,l){for(var a=0;a<l.length;a++,t+=4)e.setFloat32(t,l[a],!0)}function Te(e,t,l){for(var a=0;a<l.length;a++,t+=2){var u=Math.max(-1,Math.min(1,l[a]));e.setInt16(t,u<0?u*32768:u*32767,!0)}}function P(e,t,l){for(var a=0;a<l.length;a++)e.setUint8(t+a,l.charCodeAt(a))}const We={class:"row col-12 q-gutter-md justify-center"},Ke={class:"row col-12 q-gutter-md justify-center"},Xe={class:"text-body"},Ge={class:"row col-12 q-gutter-md justify-center"},et=$e({name:"file_sounds",setup(e){const t=x(),l=new FileReader,a=x(0),u=x(0);let i=new ArrayBuffer(0);const d=x(new Int8Array),b=new AudioContext;x(!0);const r=x(),w=x(new Float32Array),k=x(44100),h=x(1),S=x(!1),V=`
function normalize(arr){
  // Peak volume detection
  let min = 1, max = -1
  arr.forEach((v,i)=>{
    if(v < min) min = v
    if(v > max) max = v
  })
  const diff = max - min
  if(diff === 0) return
  arr.forEach((v,i)=>{
    arr[i] = (arr[i] - min) / diff * 2 - 1
  })
}

onmessage = (e) => {
  let data = e.data
  if(data.name === "render") {
    let { sample_byte, ta, length, use_normalizer } = data
    let result = new Float32Array(length)
    if(sample_byte === 1){
      for(let i = 0; i < length; i++){
        if(i % 20000 === 0){
          postMessage({ name: "progress", value: i / length })
        }
        result[i] = ta[i] / (2 ** 7 - (result[i] > 0 ? 1 : 0))
      }
    } else {
      for(let i = 0; i < length; i++){
        let temp = 0
        for(let j = 0; j < sample_byte; j++){
          temp += ta[i * sample_byte + j]
          temp <<= 8
        }
        temp >>= 8
        if(i % 20000 === 0){
          postMessage({ name: "progress", value: i / length })
        }
        result[i] = temp / (2 ** (sample_byte * 8 - 1) - (result[i] > 0 ? 1 : 0))
      }
    }
    if(use_normalizer){
      normalize(result)
    }
    postMessage({ name: "render_finish", result })
  }
};
`,B=new Blob([V]),s=new Worker(URL.createObjectURL(B));s.onmessage=f=>{var g;let v=f.data;if(v.name==="progress")u.value=v.value;else if(v.name==="render_finish"){u.value=1;try{(g=r.value)==null||g.stop()}catch{}let q=v.result;w.value=q;const U=b.createBuffer(1,d.value.length,k.value);U.copyToChannel(q,0),console.log(q);const $=b.createBufferSource();$.buffer=U,$.connect(b.destination),r.value=$}},De(t,()=>{let f=t.value;f&&(l.onprogress=v=>{a.value=v.loaded/v.total},l.onload=o,l.readAsArrayBuffer(f))});function o(){a.value=1,i=l.result,d.value=new Int8Array(i)}function j(){s.postMessage({name:"render",sample_byte:h.value,ta:d.value,length:d.value.length/h.value,use_normalizer:S.value})}function D(){let f=r.value;f&&f.start(),u.value=0}function Q(){var f;(f=r.value)==null||f.stop()}function N(){const f=b.createBuffer(1,d.value.length/h.value,k.value);f.copyToChannel(w.value,0);const v=Ne(f,{float32:!0});console.log(new Int8Array(v));const g=new Blob([v],{type:"audio/x-wav"}),q=document.createElement("a");q.href=window.URL.createObjectURL(g),q.download="audio.wav",q.click()}return(f,v)=>(Ie(),Ue(Fe,{class:"row justify-center text-left"},{default:p(()=>[C(we,{class:"col-sm-11 col-md-10"},{default:p(()=>[C(G,{class:"q-gutter-md row justify-center"},{default:p(()=>[C(Pe,{class:"col-10",outlined:"",modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=g=>t.value=g),label:"\u6587\u4EF6"},null,8,["modelValue"]),C(Y,{class:"col-10",value:a.value,"animation-speed":100,color:a.value!==1?"primary":"positive",style:{height:"4px"}},null,8,["value","color"]),C(Y,{class:"col-10",value:u.value,"animation-speed":0,color:u.value!==1?"primary":"positive",style:{height:"4px"}},null,8,["value","color"])]),_:1}),C(G,{class:"q-gutter-md row justify-center"},{default:p(()=>[z("div",We,[C(R,{label:"\u6E32\u67D3",onClick:j,disable:!t.value},null,8,["disable"]),C(H,{label:"\u91C7\u6837\u7387",modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=g=>k.value=g)},null,8,["modelValue"]),C(H,{label:"\u4F4D",modelValue:h.value,"onUpdate:modelValue":v[2]||(v[2]=g=>h.value=g)},null,8,["modelValue"]),C(qe,{label:"\u54CD\u5EA6\u6807\u51C6\u5316",modelValue:S.value,"onUpdate:modelValue":v[3]||(v[3]=g=>S.value=g)},null,8,["modelValue"])]),z("div",Ke,[C(R,{label:"\u64AD\u653E",onClick:D,disable:u.value!==1},null,8,["disable"]),C(R,{label:"\u505C\u6B62",onClick:Q,disable:!t.value},null,8,["disable"]),z("div",Xe,"\u97F3\u9891\u65F6\u957F\uFF1A"+Re((d.value.length/k.value/h.value).toFixed(2))+" s",1)]),z("div",Ge,[C(R,{label:"\u751F\u6210\u4E3A WAV",onClick:N,disable:u.value!==1},null,8,["disable"])])]),_:1})]),_:1})]),_:1}))}});export{et as default};
